
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
    id("com.facebook.react")
    id("com.google.gms.google-services")
    id("com.google.firebase.crashlytics")
}

/**
 * Set this to true to Run Proguard on Release builds to minify the Java bytecode.
 */
def enableProguardInReleaseBuilds = false

// background-geolocation
Project background_geolocation = project(':react-native-background-geolocation')
apply from: "${background_geolocation.projectDir}/app.gradle"


android {
    ndkVersion "26.1.10909125"

    buildToolsVersion "35.0.0"
    compileSdkVersion 35

    namespace "org.sailyachtresearch.sailinsight"
    defaultConfig {
        applicationId "org.sailyachtresearch.sailinsight"
        minSdkVersion 24
        targetSdkVersion 34
        versionCode 168
        versionName "2.10.0"

        missingDimensionStrategy 'react-native-camera', 'general'
    }

    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
        release {
            if (project.hasProperty('SAIL_INSIGHT_UPLOAD_STORE_FILE')) {
                storeFile file(SAIL_INSIGHT_UPLOAD_STORE_FILE)
                storePassword SAIL_INSIGHT_UPLOAD_STORE_PASSWORD
                keyAlias SAIL_INSIGHT_UPLOAD_KEY_ALIAS
                keyPassword SAIL_INSIGHT_UPLOAD_KEY_PASSWORD
            }
        }
    }
    // Java/Kotlin options as needed // RNU ds 3 optional
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }
    kotlinOptions {
        jvmTarget = "17"
    }
    buildFeatures {
        buildConfig true
    }
    buildTypes {
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            // Caution! In production, you need to generate your own keystore file.
            // see https://reactnative.dev/docs/signed-apk-android.
            signingConfig signingConfigs.release
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
            shrinkResources false
        }
    }

    flavorDimensions "default"

    productFlavors {
        dev {
            dimension "default"
            manifestPlaceholders = [
                    branchIOKey: System.getenv("BRANCH_IO_KEY") ?: "key_live_kjHOAqtytu1CNDoBMOW9OfcdyEd1gPL0",
                    branchIOTestKey: System.getenv("BRANCH_IO_TEST_KEY") ?: "key_test_lhTIEBBwuu6qPvasPZfUcnlgyyb3fI7p",
                    branchIOAppLink: System.getenv("BRANCH_IO_APP_DOMAIN") ?: "sailinsight30-app.sapsailing.com",
                    branchIOTestMode: false,
                    branchIOScheme: System.getenv("BRANCH_IO_SCHEME") ?: "orgsailyachtresearchsailinsight",
            ]
        }
         live {
             dimension "default"
             manifestPlaceholders = [
                     branchIOKey: System.getenv("BRANCH_IO_KEY") ?: "key_live_kjHOAqtytu1CNDoBMOW9OfcdyEd1gPL0",
                     branchIOTestKey: System.getenv("BRANCH_IO_TEST_KEY") ?: "key_test_lhTIEBBwuu6qPvasPZfUcnlgyyb3fI7p",
                     branchIOAppLink: System.getenv("BRANCH_IO_APP_DOMAIN") ?: "sailinsight30-app.sapsailing.com",
                     branchIOTestMode: false,
                     branchIOScheme: System.getenv("BRANCH_IO_SCHEME") ?: "orgsailyachtresearchsailinsight",
             ]
         }
    }
}

react {
    nodeExecutableAndArgs = ["node", "--no-warnings"]
    // RNU ds 3

    autolinkLibrariesWithApp()

    // jsEngine("hermes")
}

dependencies {
    // implementation(project(":react-native-branch"))
    implementation("com.facebook.react:react-android")
    implementation("com.facebook.react:hermes-android")
}

tasks.matching { it.name == "generateAutolinkingPackageList" }.configureEach {
  if (it instanceof Exec) {
    workingDir = file("..")            // <â€” critical
    environment "NODE_NO_WARNINGS", "1"
    environment "FORCE_COLOR", "0"
  }
}
